{% macro tooltip(info) %}
  <span class="trace_s">{{ "%+0.2f" |format(info.elapsedTime) }}s
    <span class="trace_tooltip">Function {{ info.class }}::{{ info.function }}()<br />
      Line:&nbsp;{{ info.line }}<br />
      File:&nbsp;{{ info.file }}<br />
      <br />
      Code snippet:
      <pre>{{ info.snippet }}</pre>
    </span>
  </span>
{% endmacro %}

{% macro traceItem(item, content) %}
<div class="trace">
  {{ _self.tooltip(item.info) }}
  {{ content }}
</div>
{% endmacro %}

{% macro traceDataContent(value) %}
  <pre>{{ value }}</pre>
{% endmacro%}

{% macro traceVariableContent(name, value) %}
  ${{ name }}:= <pre class="trace">{{ value }}</pre>
{% endmacro %}

{% macro trace(trace) %}
  {# TODO use collapsible tag here when it's done #}
  {# following is a test of unique tag, to be replaced when collapsible is done #}
  {% unique div id %}
  <div class="collapsible" id="{{ id }}">
    <div><strong>{{ trace.header }}</strong></div>
    {% for child in trace.children %}
      {% if child.type == "log" %}
        {{ _self.traceItem(child, child.data) }}
      {% elseif child.type == "data" %}
        {{ _self.traceItem(child, _self.traceDataContent(child.data)) }}
      {% elseif child.type == "variable" %}
        {{ _self.traceItem(child, _self.traceVariableContent(child.name, child.data)) }}
      {% elseif child.type == "trace" %}
        {{ _self.traceItem(child, _self.trace(child.trace)) }}
      {% endif %}
    {% endfor %}
  </div>
{% endmacro %}